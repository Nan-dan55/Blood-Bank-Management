<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>All Pending Donation Requests</title>
  <!-- Font Awesome for icons -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  />
  <link rel="stylesheet" href="/css/nav.css" />
  <link rel="stylesheet" href="/css/donor-available-request.css" />
</head>
<body>
    <!-- Add user data script -->
    <script>
        window.userData = <%- JSON.stringify(user || null).replace(/'/g, "\\'") %>;
    </script>

    <!-- Include navigation -->
    <%- include('nav') %>

    <div class="main-content">

<!-- If using a separate hamburger.html partial, do this instead:
     <div id="commonNav"></div>
     and fetch it via JavaScript at the bottom. 
     Otherwise, embed your top bar & sidebar here. -->

     <div id="commonNav"></div>

<div class="main-content">
  <h1>All Pending Donation Requests</h1>
  
  <!-- Search and Filter Section -->
  <div class="search-filter-section">
    <!-- Location Search -->
    <div class="search-group">
      <div class="search-input">
        <i class="fas fa-search"></i>
        <input 
          type="text" 
          id="locationSearch" 
          placeholder="Search by location..."
          title="Enter hospital name, city, or address"
        >
      </div>
    </div>

    <!-- Blood Type Filter -->
    <div class="filter-group">
      <label for="bloodGroupFilter">
        <i class="fas fa-tint"></i>
        Blood Group:
      </label>
      <select id="bloodGroupFilter">
        <option value="">All Blood Groups</option>
        <option value="A+">A+</option>
        <option value="A-">A-</option>
        <option value="B+">B+</option>
        <option value="B-">B-</option>
        <option value="AB+">AB+</option>
        <option value="AB-">AB-</option>
        <option value="O+">O+</option>
        <option value="O-">O-</option>
      </select>
    </div>

    <!-- Status Filter -->
    <div class="filter-group">
      <label for="statusFilter">
        <i class="fas fa-filter"></i>
        Status:
      </label>
      <select id="statusFilter">
        <option value="all">All Status</option>
        <option value="pending">Pending</option>
        <option value="inprogress">In Progress</option>
        <option value="done">Completed</option>
        <option value="cancel">Cancelled</option>
      </select>
    </div>

    <!-- Emergency Filter -->
    <div class="filter-group">
      <label class="checkbox-label">
        <input type="checkbox" id="emergencyFilter">
        <i class="fas fa-ambulance"></i>
        Emergency Only
      </label>
    </div>
  </div>

  <!-- Active Filters Display -->
  <div class="active-filters" id="activeFilters">
    <!-- Active filters will be displayed here -->
  </div>
  
  <!-- Table of Requests -->
  <div class="table-container">
    <table id="requestTable">
      <thead>
        <tr>
          <th>Recipient Name</th>
          <th>Blood Group</th>
          <th>Date & Time</th>
          <th>Hospital Name</th>
          <th>Full Address</th>
          <th>Reason</th>
          <th>Status</th>
          <th>Emergency</th>
          <th>View</th>
          <th>Confirm</th>
          <th>Cancel</th>
        </tr>
      </thead>
      <tbody>
        <!-- Populated by JavaScript -->
      </tbody>
    </table>
  </div>

  <!-- No Results Message -->
  <div id="noResults" class="no-results" style="display: none;">
    <i class="fas fa-search"></i>
    <p>No matching requests found</p>
  </div>
</div>

<!-- Request Details Modal -->
<div class="modal-overlay" id="requestModalOverlay" style="display: none;">
  <div class="modal" id="requestModal">
    <h2>Blood Donation Request details</h2>
    <p><strong>Recipient Name:</strong> <span id="modalRecipientName"></span></p>
    <p><strong>Recipient Blood Group:</strong> <span id="modalRecipientBloodGroup"></span></p>
    <p><strong>Donation's Date & Time:</strong> <span id="modalDateTime"></span></p>
    <p><strong>Donation Address:</strong> <span id="modalAddress"></span></p>
    <p><strong>Recipient Hospital Name:</strong> <span id="modalHospitalName"></span></p>
    <p><strong>Reason for donation:</strong> <span id="modalReason"></span></p>
    <p><strong>Donation Status:</strong> <span id="modalStatus"></span></p>
    <p><strong>Emergency:</strong> <span id="modalEmergency"></span></p>
    <button class="btn-donate" id="donateBtn">Donate</button>
    <button class="btn-cancel" id="closeRequestModal">Close</button>
  </div>
</div>

<!-- Donate (Confirm) Modal -->
<div class="modal-overlay" id="donateModalOverlay" style="display: none;">
  <div class="modal" id="donateModal">
    <h2>Confirm Donation</h2>
    <label for="donorNameInput">Donor Name:</label>
    <input type="text" id="donorNameInput" />

    <label for="donorEmailInput">Donor Email:</label>
    <input type="email" id="donorEmailInput" />

    <button class="btn-confirm" id="confirmDonationBtn">Confirm Donation</button>
    <button class="btn-cancel" id="closeDonateModal">Cancel</button>
  </div>
</div>

<!-- Confirmed Modal -->
<div class="modal-overlay" id="confirmedModalOverlay" style="display: none;">
  <div class="modal" id="confirmedModal">
    <h2>Confirmed!</h2>
    <p>Your request to donate blood is confirmed</p>
    <button class="btn-ok" id="closeConfirmedModal">Ok!</button>
  </div>
</div>
<script src="/js/config.js"></script>
<script src="/js/nav.js"></script>
<script>
    // Ensure correct navigation highlighting
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(() => {
            const bloodRequestLink = document.querySelector('[data-page="donor-available-requests"]');
            if (bloodRequestLink) {
                bloodRequestLink.style.color = '#e74c3c';
                bloodRequestLink.style.backgroundColor = 'rgba(231, 76, 60, 0.1)';
            }
        }, 100);
    });
</script>
<script src="/js/donor-available-request.js"></script>
</div>
</body>
</html>
